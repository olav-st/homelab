extraEnv: |
  - name: KEYCLOAK_USER
    value: admin
  - name: KEYCLOAK_PASSWORD_FILE
    value: /secrets/admin-creds/pazzword
  - name: KC_HOSTNAME_STRICT
    value: "false"
  - name: KC_PROXY
    value: edge
  - name: KC_HTTP_ENABLED
    value: "true"
  - name: KEYCLOAK_FRONTEND_URL
    value: "https://keycloak.homelab.olav.ninja"
  - name: KC_HOSTNAME_PATH
    value: "/"
  - name: KC_HOSTNAME_URL
    value: "https://keycloak.homelab.olav.ninja"
  - name: KC_HOSTNAME_ADMIN_URL
    value: "https://keycloak.homelab.olav.ninja"

  - name: DB_VENDOR
    value: postgres
  - name: DB_ADDR
    value: keycloak-postgresql-rw
  - name: DB_PORT
    value: "5432"
  - name: DB_DATABASE
    value: keycloak
  - name: DB_USER_FILE
    value: /secrets/db-creds/user
  - name: DB_PASSWORD_FILE
    value: /secrets/db-creds/password

resources:
  requests:
    cpu: 500m
    memory: 1024Mi
  limits:
    memory: 3072Mi

ingress:
  enabled: true
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt
    traefik.ingress.kubernetes.io/router.entrypoints: websecure, webpublic
  rules:
    - host: keycloak.homelab.olav.ninja
      paths:
        - path: /
          pathType: Prefix
  tls:
    - hosts:
        - keycloak.homelab.olav.ninja
      secretName: keycloak-tls-secret

postgresql:
  enabled: false # We use CNPG to create the database instead

extraVolumeMounts: |
  - name: admin-creds
    mountPath: /secrets/admin-creds
    readOnly: true
  - name: db-creds
    mountPath: /secrets/db-creds
    readOnly: true

extraVolumes: |
  - name: admin-creds
    secret:
      secretName: keycloak-admin-password
  - name: db-creds
    secret:
      secretName: keycloak-postgresql-app

service:
  type: ClusterIP
  httpPort: 8080
